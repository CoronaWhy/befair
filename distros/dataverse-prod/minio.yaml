version: '3.7'
services:
  minio:
    image: minio/minio
    #ports:
    #  - "9000:9000"
    environment:
      MINIO_ROOT_USER: minio_user
      MINIO_ROOT_PASSWORD: minio_password
      GOOGLE_APPLICATION_CREDENTIALS: "/credentials.json"
    command: minio gateway gcs coronawhy-gcp-2
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]
      interval: 30s
      timeout: 20s
      retries: 3
    volumes:
      #- ./secrets/minio/credentials.json:/credentials.json
      - /opt/dataverse/befair/distros/dataverse-prod/secrets/minio/credentials.json:/credentials.json
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.minio.rule=Host(`minio.${traefikhost}`)"
      - "traefik.http.services.minio.loadbalancer.server.port=9000"
      - "traefik.http.routers.minio.tls=true"
      - "traefik.http.routers.minio.tls.certresolver=myresolver"  

